<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voxel Sandbox</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/minecraft-framework-css@1.1.9/css/main.css">
    <script src="https://unpkg.com/minecraft-framework-css@1.1.9/css/assets/script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <h2 id="loading-text">Loading World...</h2>
            <div class="loading-bar-container">
                <div id="loading-bar" class="loading-bar"></div>
            </div>
            <div id="loading-tips" class="loading-tips"></div>
        </div>
    </div>
    <!-- Main Menu -->
    <div id="menu-container">
        <!-- Main menu screen -->
        <div id="main-menu" class="menu-screen">
            <div class="minecraft-logo">
                <img src="Minecraftlogo.png" alt="Minecraft Logo">
            </div>
            <div class="menu-buttons">
                <button id="singleplayer-btn" class="menu-button button-java-old">Singleplayer</button>
                <button id="load-from-code-btn" class="menu-button button-java-old">Load from Code</button>
                <button id="mods-btn" class="menu-button button-java-old">Mods</button>
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <button id="options-btn" class="menu-button button-java-old" style="width: 295px; margin-right: 5px;">Options...</button>
                    <button id="quit-game-btn" class="menu-button button-java-old" style="width: 295px; margin-left: 5px;" onclick="window.location.href='https://websim.com'">Quit Game</button>
                </div>
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <button id="update-log-btn" class="menu-button button-java-old" style="width: 295px; margin-right: 5px;">Update Log</button>
                    <button id="information-btn" class="menu-button button-java-old" style="width: 295px; margin-left: 5px;">Controls Information</button>
                </div>
            </div>
            <div class="minecraft-footer">
                <span class="minecraft-version">Minecraft WE - V1.5</span>
                <span class="minecraft-copyright">Copyright Mojang AB. Do not distribute!</span>
            </div>
        </div>
        
        <!-- Device Selection Dialog -->
        <div id="device-selection-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Select Your Device</h2>
                <p class="information-text" style="color: #ccc; font-size: 1.1em; margin-bottom: 20px;">This will optimize controls for your experience.</p>
                <div class="dialog-buttons">
                    <button id="mobile-device-btn" class="menu-button button-java-old">Mobile</button>
                    <button id="pc-device-btn" class="menu-button button-java-old">Laptop / PC</button>
                    <button id="device-back-btn" class="menu-button button-java-old" style="margin-top: 20px;">Back</button>
                </div>
            </div>
        </div>
        
        <!-- Information Dialog -->
        <div id="information-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Controls Information</h2>
                <div class="controls-info-text" style="text-align: left; max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                    
                    <h3><img src="grass.png" style="width:16px; height: 16px; image-rendering: pixelated; vertical-align: middle;"> Keyboard & Mouse</h3>
                    <p><strong>Movement:</strong> WASD</p>
                    <p><strong>Jump:</strong> Space</p>
                    <p><strong>Sprint:</strong> Left Shift</p>
                    <p><strong>Inventory:</strong> E</p>
                    <p><strong>Break / Interact:</strong> Left Click</p>
                    <p><strong>Place:</strong> Right Click</p>
                    <p><strong>Drop Item:</strong> Q</p>
                    <p><strong>Crouch:</strong> C</p>
                    <p><strong>Split Stack:</strong> Right Click (in inventory)</p>
                    
                    <h3 style="margin-top: 20px;"><img src="plank.png" style="width:16px; height: 16px; image-rendering: pixelated; vertical-align: middle;"> Mobile Controls</h3>
                    <p><strong>Joystick:</strong> Located on the left — hold fully forward to sprint.</p>
                    <p><strong>Jump Button:</strong> On the right — tap to jump.</p>
                    <p><strong>Camera Movement:</strong> Drag your finger across the screen.</p>
                    <p><strong>Block Breaking:</strong> Hold your finger on a block for at least 0.3 seconds to begin breaking it.</p>
                    <p><strong>Block Placing:</strong> Quickly tap a surface to place a block.</p>
                    <p><strong>Inventory:</strong> Tap the chest icon at the top of the screen to open your inventory.</p>
                    <p><strong>Item Management:</strong> Drag items with your finger to move them around.</p>
                    <p>⚠️ Note: You must use quick crafting on mobile — splitting stacks is not supported at this time.</p>

                    <h3 style="margin-top: 20px;"><img src="stone.png" style="width:16px; height: 16px; image-rendering: pixelated; vertical-align: middle;"> Controller Support</h3>
                    <p><strong>D-Pad / Left Stick:</strong> Use to navigate through menus and inventory.</p>
                    <p><strong>A / X Button:</strong> Jump and select/grab items in inventory.</p>
                    <p><strong>B / O Button:</strong> Cancel actions (like block breaking) or go back in menus.</p>
                    <p><strong>X / Square or Y / Triangle:</strong> Open inventory.</p>
                    <p><strong>LB / L1 & RB / R1:</strong> Navigate hotbar slots.</p>
                    <p><strong>LT / L2:</strong> Place block.</p>
                    <p><strong>RT / R2:</strong> Break block.</p>
                    <p><strong>Start / Options Button:</strong> Pause game or open settings.</p>
                    <p><strong>Quick Craft Only:</strong> Like on mobile, stack splitting isn't supported — use quick crafting.</p>
                    <p><strong>Tested Controllers:</strong> DualSense (PlayStation) and Xbox controllers work well!</p>
                    <p><strong>Untested:</strong> Joy-Cons and Switch Pro Controllers haven't been tested. If you run into issues, let us know.</p>

                </div>
                <div class="dialog-buttons" style="margin-top: 20px;">
                    <button id="close-information-dialog-btn" class="menu-button button-java-old">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Block Creation Dialog -->
        <div id="block-creation-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content block-texture-content">
                <h2>Block Creator</h2>
                <div class="block-texture-form">
                    <div class="block-name-input">
                        <label for="block-name">Block Name:</label>
                        <input type="text" id="block-name" placeholder="Enter block name">
                    </div>
                    <div class="block-options">
                         <label class="toggle-label">
                            <span>Use same texture for all sides:</span>
                            <input type="checkbox" id="same-texture-toggle" checked>
                        </label>
                    </div>
                    <div class="block-options">
                        <label class="toggle-label">
                            <span>Is Slab:</span>
                            <input type="checkbox" id="is-slab-checkbox">
                        </label>
                        <div class="settings-hint">Half-height blocks like wooden slabs.</div>
                    </div>
                    <div class="block-options">
                        <label for="block-category-select">Block Category:</label>
                        <select id="block-category-select" class="minecraft-select">
                            <option value="simple">Default (Dirt/Grass)</option>
                            <option value="wood">Wood</option>
                            <option value="rock">Stone</option>
                        </select>
                        <div class="settings-hint">Determines break speed and sounds.</div>
                    </div>

                    <!-- Container for single texture upload -->
                    <div id="single-texture-upload-container">
                        <div class="texture-upload-item">
                            <label for="texture-all">All Faces:</label>
                            <div class="texture-preview" id="preview-all"></div>
                            <input type="file" id="texture-all" class="texture-file" accept="image/png" data-face="all">
                        </div>
                    </div>
                    
                    <!-- Container for multiple texture uploads -->
                    <div id="multi-texture-upload-container" class="texture-upload-grid" style="display: none;">
                        <div class="texture-upload-item">
                            <label for="texture-top">Top Face:</label>
                            <div class="texture-preview" id="preview-top"></div>
                            <input type="file" id="texture-top" class="texture-file" accept="image/png" data-face="top">
                        </div>
                        <div class="texture-upload-item">
                            <label for="texture-bottom">Bottom Face:</label>
                            <div class="texture-preview" id="preview-bottom"></div>
                            <input type="file" id="texture-bottom" class="texture-file" accept="image/png" data-face="bottom">
                        </div>
                        <div class="texture-upload-item">
                            <label for="texture-front">Front Face:</label>
                            <div class="texture-preview" id="preview-front"></div>
                            <input type="file" id="texture-front" class="texture-file" accept="image/png" data-face="front">
                        </div>
                        <div class="texture-upload-item">
                            <label for="texture-back">Back Face:</label>
                            <div class="texture-preview" id="preview-back"></div>
                            <input type="file" id="texture-back" class="texture-file" accept="image/png" data-face="back">
                        </div>
                        <div class="texture-upload-item">
                            <label for="texture-left">Left Face:</label>
                            <div class="texture-preview" id="preview-left"></div>
                            <input type="file" id="texture-left" class="texture-file" accept="image/png" data-face="left">
                        </div>
                        <div class="texture-upload-item">
                            <label for="texture-right">Right Face:</label>
                            <div class="texture-preview" id="preview-right"></div>
                            <input type="file" id="texture-right" class="texture-file" accept="image/png" data-face="right">
                        </div>
                    </div>

                    <div class="dialog-buttons texture-submit-buttons">
                        <button id="next-to-crafting-btn" class="menu-button button-java-old">Next (Add Recipe)</button>
                        <button id="save-block-no-recipe-btn" class="menu-button button-java-old">Save without Recipe</button>
                        <button id="cancel-block-creation-btn" class="menu-button button-java-old">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Crafting Recipe Creator -->
        <div id="crafting-recipe-creator" class="minecraft-dialog">
            <div class="minecraft-dialog-content crafting-recipe-content">
                <h2>Create Crafting Recipe</h2>
                <div class="crafting-recipe-form">
                    <p class="crafting-instructions">Select blocks to create your crafting recipe</p>
                    <div class="crafting-recipe-grid">
                        <div class="crafting-recipe-slot" data-index="0"></div>
                        <div class="crafting-recipe-slot" data-index="1"></div>
                        <div class="crafting-recipe-slot" data-index="2"></div>
                        <div class="crafting-recipe-slot" data-index="3"></div>
                        <div class="crafting-recipe-slot" data-index="4"></div>
                        <div class="crafting-recipe-slot" data-index="5"></div>
                        <div class="crafting-recipe-slot" data-index="6"></div>
                        <div class="crafting-recipe-slot" data-index="7"></div>
                        <div class="crafting-recipe-slot" data-index="8"></div>
                    </div>
                    <div class="crafting-block-selector">
                        <h3>Available Blocks</h3>
                        <div class="block-selector-grid" id="block-selector-grid"></div>
                    </div>
                    <div class="dialog-buttons recipe-submit-buttons">
                        <button id="save-recipe-btn" class="menu-button button-java-old">Save Recipe</button>
                        <button id="skip-recipe-btn" class="menu-button button-java-old">Skip</button>
                        <button id="cancel-recipe-btn" class="menu-button button-java-old">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mod Management Screen (Previously Mod Import Dialog) -->
        <div id="mod-management-screen" class="menu-screen" style="display: none;">
            <h2>Mods</h2>
            <div id="available-mods-list" class="mods-list">
                <!-- Mod items will be added here dynamically -->
            </div>
            <div class="menu-buttons">
                <button id="create-mod-btn" class="menu-button button-java-old">Create New Mod</button>
                <button id="share-selected-mods-btn" class="menu-button button-java-old">Share Selected Mods</button>
                <button id="close-mods-screen-btn" class="menu-button button-java-old">Back</button>
            </div>
        </div>
        
        <!-- NEW: Structure Size Dialog -->
        <div id="structure-size-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Create Structure</h2>
                <div class="settings-container">
                    <p class="settings-hint" style="text-align: center; margin-bottom: 15px;">Define the size of the flat area where you will build your structure.</p>
                    <div class="settings-option">
                        <label for="structure-width">Width: <span id="structure-width-value">16</span></label>
                        <input type="range" id="structure-width" min="8" max="64" value="16" step="8" class="settings-slider">
                    </div>
                    <div class="settings-option">
                        <label for="structure-length">Length: <span id="structure-length-value">16</span></label>
                        <input type="range" id="structure-length" min="8" max="64" value="16" step="8" class="settings-slider">
                    </div>
                </div>
                <div class="dialog-buttons">
                    <button id="start-building-btn" class="menu-button button-java-old">Start Building</button>
                    <button id="cancel-structure-size-btn" class="menu-button button-java-old">Cancel</button>
                </div>
            </div>
        </div>

        <!-- NEW: Save Structure Dialog -->
        <div id="save-structure-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Save Structure</h2>
                <div class="settings-container">
                    <div class="form-group">
                        <label for="structure-name-input">Structure Name:</label>
                        <input type="text" id="structure-name-input" placeholder="My Awesome Castle">
                    </div>
                    <div class="settings-option">
                        <label for="structure-rarity-slider">Rarity: <span id="rarity-value">Normal</span></label>
                        <input type="range" id="structure-rarity-slider" min="0" max="4" value="2" class="settings-slider">
                        <div class="settings-hint">How often the structure will appear in the world.</div>
                    </div>
                    <div class="form-group">
                        <label for="structure-biome-select">Spawn in Biomes:</label>
                        <select id="structure-biome-select" multiple size="5"></select>
                         <div class="settings-hint">Hold Ctrl (or Cmd) to select multiple biomes.</div>
                    </div>
                </div>
                <div class="dialog-buttons">
                    <button id="confirm-save-structure-btn" class="menu-button button-java-old">Save Structure</button>
                    <button id="cancel-save-structure-btn" class="menu-button button-java-old">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Update Log Dialog -->
        <div id="update-log-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Update Log</h2>
                <div class="update-log-text">
                    <p><strong>V1.5 Minecraft WebSim Edition – Pocket & Pads Welcome!</strong></p>
                    <ul>
                        <li><strong>Mobile Support!</strong> You can now play Minecraft WebSim on mobile with full touch controls!</li>
                        <li><strong>Joystick:</strong> Located on the left — hold fully forward to sprint.</li>
                        <li><strong>Jump Button:</strong> On the right — tap to jump.</li>
                        <li><strong>Camera Movement:</strong> Drag your finger across the screen.</li>
                        <li><strong>Block Breaking:</strong> Hold your finger on a block for at least 0.3 seconds to begin breaking it.</li>
                        <li><strong>Block Placing:</strong> Quickly tap a surface to place a block.</li>
                        <li><strong>Inventory:</strong> Tap the chest icon at the top of the screen to open your inventory. Drag items with your finger to move them around.</li>
                        <li>⚠️ Note: You must use quick crafting on mobile — splitting stacks is not supported at this time.</li>
                        <li style="margin-top: 10px;"><strong>Controller Support!</strong></li>
                        <li><strong>D-Pad Navigation:</strong> Use the D-pad to move through menus and inventory.</li>
                        <li><strong>Quick Craft Only:</strong> Like on mobile, stack splitting isn't supported — use quick crafting.</li>
                        <li><strong>Tested Controllers:</strong> DualSense (PlayStation) and Xbox controllers work well!</li>
                        <li><strong>Untested:</strong> Joy-Cons and Switch Pro Controllers haven't been tested. If you run into issues, let us know.</li>
                        <li style="margin-top: 10px;"><strong>General Changes</strong></li>
                        <li>Updated Logo, Version Number, and changelog.</li>
                        <li>Upon loading into a world you will be put into Fullscreen.</li>
                        <li>Added a quick-crafting menu to the inventory.</li>
                        <li>Improved creative mode flow for smoother gameplay.</li>
                        <li>Renamed "Information" to "Control Information", now includes detailed mobile and controller control layouts.</li>
                        <li>Adjusted default camera sensitivity for all input types.</li>
                    </ul>
                </div>
                <div class="dialog-buttons">
                    <button id="close-update-log-dialog-btn" class="menu-button button-java-old">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Options menu screen -->
        <div id="options-menu" class="menu-screen">
            <h2>Options</h2>
            <div class="minecraft-options-grid">
                <button id="fov-settings-btn" class="minecraft-option-button button-java-old">FOV: Normal</button>
                <button id="sound-settings-btn" class="minecraft-option-button button-java-old">Sounds...</button>
                <button id="video-settings-btn" class="minecraft-option-button button-java-old">Video Settings...</button>
                <button id="controls-settings-btn" class="minecraft-option-button button-java-old">Controls...</button>
            </div>
            <div class="menu-buttons options-done-container">
                <button id="save-options-btn" class="menu-button button-java-old">Done</button>
            </div>
        </div>
        
        <!-- FOV Settings submenu -->
        <div id="fov-submenu" class="menu-screen">
            <h2>FOV Settings</h2>
            <div class="settings-container">
                <div class="settings-option">
                    <label for="fov-slider">FOV: <span id="fov-value">70</span></label>
                    <input type="range" id="fov-slider" min="30" max="110" value="70" class="settings-slider">
                    <div class="settings-hint">Higher values = wider field of view</div>
                </div>
            </div>
            <div class="menu-buttons">
                <button id="fov-back-btn" class="menu-button button-java-old">Done</button>
            </div>
        </div>

        <!-- Sound Settings submenu -->
        <div id="sound-submenu" class="menu-screen">
            <h2>Sound Settings</h2>
            <div class="settings-container">
                <div class="settings-option">
                    <label for="master-volume-slider">Master Volume: <span id="master-volume-value">100%</span></label>
                    <input type="range" id="master-volume-slider" min="0" max="100" value="100" class="settings-slider">
                </div>
                <div class="settings-option">
                    <label for="music-volume-slider">Music: <span id="music-volume-value">100%</span></label>
                    <input type="range" id="music-volume-slider" min="0" max="100" value="100" class="settings-slider">
                </div>
                <div class="settings-option">
                    <label for="sound-volume-slider">Sound: <span id="sound-volume-value">100%</span></label>
                    <input type="range" id="sound-volume-slider" min="0" max="100" value="100" class="settings-slider">
                </div>
            </div>
            <div class="menu-buttons">
                <button id="sound-back-btn" class="menu-button button-java-old">Done</button>
            </div>
        </div>

        <!-- Video Settings submenu -->
        <div id="video-submenu" class="menu-screen">
            <h2>Video Settings</h2>
            <div class="settings-container">
                <div class="settings-option">
                    <label for="render-distance-menu-slider">Render Distance: <span id="render-distance-menu-value">6</span></label>
                    <input type="range" id="render-distance-menu-slider" min="3" max="16" value="6" class="settings-slider">
                    <div class="settings-hint">Higher values = more chunks visible, lower performance</div>
                </div>
                
                <div class="settings-option">
                    <label for="shadow-menu-toggle" class="toggle-label">
                        Shadows: 
                        <input type="checkbox" id="shadow-menu-toggle" checked>
                    </label>
                    <div class="settings-hint">Disable shadows to improve performance on slower devices</div>
                </div>
                
                <div class="settings-option">
                    <label for="fog-menu-toggle" class="toggle-label">
                        Fog: 
                        <input type="checkbox" id="fog-menu-toggle" checked>
                    </label>
                    <div class="settings-hint">Adds distance fog for a more realistic appearance</div>
                </div>
                
                <div class="settings-option">
                    <label for="show-fps-toggle" class="toggle-label">
                        Show FPS:
                        <input type="checkbox" id="show-fps-toggle">
                    </label>
                    <div class="settings-hint">Displays the current frames per second on screen.</div>
                </div>

                <div class="settings-option">
                    <label for="chunk-update-slider">Chunk Update Rate: <span id="chunk-update-value">Medium</span></label>
                    <input type="range" id="chunk-update-slider" min="0" max="2" value="1" class="settings-slider">
                    <div class="settings-hint">Speed at which chunks generate (Low=1, Medium=2, High=4 chunks per frame)</div>
                </div>

                <div class="settings-option">
                    <label for="fps-cap-slider">FPS Cap: <span id="fps-cap-value">Unlimited</span></label>
                    <input type="range" id="fps-cap-slider" min="0" max="3" value="3" class="settings-slider">
                    <div class="settings-hint">Limits frames per second (30, 40, 60, Unlimited).</div>
                </div>
            </div>
            <div class="menu-buttons">
                <button id="video-back-btn" class="menu-button button-java-old">Done</button>
            </div>
        </div>

        <!-- Controls submenu -->
        <div id="controls-submenu" class="menu-screen">
            <h2>Controls</h2>
            <div class="settings-container">
                <div class="settings-option">
                    <label for="sensitivity-slider">Camera Sensitivity: <span id="sensitivity-value">100%</span></label>
                    <input type="range" id="sensitivity-slider" min="10" max="200" value="100" class="settings-slider">
                    <div class="settings-hint">Adjust how quickly the camera moves when looking around</div>
                </div>
                
                <div class="keybind-container">
                    <div class="keybind-row">
                        <span class="keybind-label">Move Forward:</span>
                        <button class="keybind-button" data-action="forward">W</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Move Backward:</span>
                        <button class="keybind-button" data-action="backward">S</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Move Left:</span>
                        <button class="keybind-button" data-action="left">A</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Move Right:</span>
                        <button class="keybind-button" data-action="right">D</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Jump:</span>
                        <button class="keybind-button" data-action="jump">Space</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Sprint:</span>
                        <button class="keybind-button" data-action="sprint">Shift</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Inventory:</span>
                        <button class="keybind-button" data-action="inventory">E</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Drop Item:</span>
                        <button class="keybind-button" data-action="drop">Q</button>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-label">Crouch:</span>
                        <button class="keybind-button" data-action="crouch">C</button>
                    </div>
                </div>
                
                <div class="settings-option reset-options">
                    <button id="reset-keybinds-btn" class="menu-button button-java-old secondary-button">Reset Keybinds</button>
                </div>
            </div>
            <div class="menu-buttons">
                <button id="controls-back-btn" class="menu-button button-java-old">Done</button>
            </div>
        </div>
        
        <!-- World selection screen -->
        <div id="world-selection" class="menu-screen">
            <h2>Select World</h2>
            <div id="worlds-list" class="worlds-list">
                <!-- World items will be added here dynamically -->
            </div>
            <div class="menu-buttons">
                <button id="create-world-btn" class="menu-button button-java-old white-text">Create New World</button>
                <button class="back-btn menu-button button-java-old">Back</button>
            </div>
        </div>
        
        <!-- Create world screen -->
        <div id="create-world-screen" class="menu-screen">
            <h2>Create New World</h2>
            <div class="world-creation-form-columns">
                <!-- Left Column -->
                <div class="world-creation-column-left">
                    <div class="form-group">
                        <label for="world-name-input">World Name:</label>
                        <input type="text" id="world-name-input" placeholder="My World">
                    </div>
                    <div class="form-group">
                        <label for="world-seed-input">Seed: (Optional)</label>
                        <input type="text" id="world-seed-input" placeholder="Leave blank for random">
                    </div>
                    <div class="menu-buttons" style="margin-top: 20px;">
                        <button id="create-new-world-btn" class="menu-button button-java-old white-text">Create New World</button>
                        <button class="back-btn menu-button button-java-old">Back</button>
                    </div>
                </div>
                <!-- Right Column -->
                <div class="world-creation-column-right">
                    <div class="form-group">
                        <div class="game-mode-options">
                            <label for="creative-toggle" class="toggle-label">
                                Creative Mode
                                <input type="checkbox" id="creative-toggle">
                            </label>
                            <div class="settings-hint">Fly, access all blocks, no damage</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="world-type-options">
                            <div class="superflat-controls">
                                <label for="superflat-toggle" class="toggle-label">
                                    Superflat World
                                    <input type="checkbox" id="superflat-toggle">
                                </label>
                                <button id="superflat-advanced-btn" class="menu-button button-java-old small-button">Advanced settings</button>
                            </div>
                            <div class="settings-hint">1 grass, 2 dirt, 1 bedrock</div>
                            <div id="superflat-structures-option" style="display: none; margin-top: 10px;">
                                <label for="superflat-structures-toggle" class="toggle-label">
                                    Generate Structures
                                    <input type="checkbox" id="superflat-structures-toggle">
                                </label>
                                <div class="settings-hint">Villages, towers, etc. will generate on the flat terrain.</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="world-size-select">World Size:</label>
                        <select id="world-size-select" class="minecraft-select">
                            <option value="infinite" selected>Infinite</option>
                            <option value="classic">Classic (864x864)</option>
                            <option value="small">Small (1024x1024)</option>
                            <option value="medium">Medium (3072x3072)</option>
                            <option value="large">Large (5120x5120)</option>
                        </select>
                        <div class="settings-hint">Choose a finite size or an infinite world.</div>
                    </div>
                    <div class="form-group">
                        <div class="game-options">
                            <label for="show-days-toggle" class="toggle-label">
                                Show Days Counter
                                <input type="checkbox" id="show-days-toggle">
                            </label>
                            <div class="settings-hint">Display a counter showing how many days you've survived</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="game-options">
                            <label for="starter-chest-toggle" class="toggle-label">
                                Starter Chest
                                <input type="checkbox" id="starter-chest-toggle">
                            </label>
                            <div class="settings-hint">Spawn a chest near your starting point with helpful items.</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="game-options">
                            <label for="always-day-toggle" class="toggle-label">
                                Always Day
                                <input type="checkbox" id="always-day-toggle">
                            </label>
                            <div class="settings-hint">The day/night cycle is disabled and the world remains in perpetual daylight.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Superflat Advanced Settings Dialog -->
        <div id="superflat-advanced-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Superflat Advanced Settings</h2>
                <div class="superflat-layers-container">
                    <div class="superflat-layer-list" id="superflat-layer-list">
                        <!-- Layers will be generated here -->
                    </div>
                    <div class="superflat-layer-controls">
                        <button id="add-layer-btn" class="menu-button button-java-old small-button">Add Layer</button>
                        <button id="reset-layers-btn" class="menu-button button-java-old small-button">Reset to Default</button>
                    </div>
                </div>
                <div class="dialog-buttons">
                    <button id="save-superflat-settings-btn" class="menu-button button-java-old">Save</button>
                    <button id="cancel-superflat-settings-btn" class="menu-button button-java-old">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Load From Code Dialog -->
        <div id="load-from-code-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Load World from Code</h2>
                <div class="form-group">
                    <label for="world-code-input">Paste World Code:</label>
                    <textarea id="world-code-input" rows="5" placeholder="Paste your world code here..."></textarea>
                </div>
                <div class="dialog-buttons">
                    <button id="load-world-btn" class="menu-button button-java-old">Load World</button>
                    <button id="cancel-load-code-btn" class="menu-button button-java-old">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Controls Info Dialog -->
        <div id="controls-info-dialog" class="minecraft-dialog">
            <div class="minecraft-dialog-content">
                <h2>Controls</h2>
                <div class="controls-info-text">
                    <p><strong>Movement:</strong> WASD</p>
                    <p><strong>Jump:</strong> Space</p>
                    <p><strong>Sprint:</strong> Left Shift</p>
                    <p><strong>Inventory:</strong> E</p>
                    <p><strong>Break / Interact:</strong> Left Click</p>
                    <p><strong>Place:</strong> Right Click</p>
                    <p><strong>Split Stack:</strong> Right Click (in inventory)</p>
                </div>
                <div class="dialog-buttons">
                    <button id="start-world-btn" class="menu-button button-java-old">Start World</button>
                    <button id="cancel-world-creation-btn" class="menu-button button-java-old">Back</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Game Container (initially hidden) -->
    <div id="game-container" style="display: none;">
        <div id="coordinates-display"></div>
        <div id="fps-display"></div>
        <canvas id="game-canvas"></canvas>
        <div id="crosshair">+</div>
        <div id="hotbar"></div>
        <div id="selected-item-name-display"></div>
        <div id="held-item-display"></div>
        
        <!-- Mobile UI -->
        <div id="mobile-controls-container">
            <div id="joystick-container"></div>
            <div id="mobile-buttons">
                <div id="mobile-top-center-buttons">
                    <button id="mobile-inventory-btn" aria-label="Inventory"></button>
                    <button id="mobile-settings-btn" aria-label="Settings"></button>
                </div>
                <div id="mobile-action-buttons">
                    <button id="mobile-jump-btn" aria-label="Jump"></button>
                </div>
            </div>
        </div>

        <!-- Dragged item visualization -->
        <div id="dragged-item" class="dragged-item"></div>

        <!-- Inventory Screen (initially hidden) -->
        <div id="inventory-screen" class="inventory-overlay">
            <button id="inventory-close-btn" class="inventory-close-btn">&times;</button>
            <div class="inventory-container">
                <div class="inventory-main-content">
                    <div class="inventory-title">Inventory</div>
                    
                    <!-- Creative Mode Tabs -->
                    <div id="creative-inventory-tabs" class="creative-tabs" style="display: none;">
                        <button class="creative-tab-button active" data-tab="1">Blocks</button>
                        <button class="creative-tab-button" data-tab="2">Mods</button>
                    </div>
                    
                    <!-- Crafting Section -->
                    <div class="crafting-section">
                        <div class="crafting-grid">
                            <div class="crafting-slot" data-slot="craft-0"></div>
                            <div class="crafting-slot" data-slot="craft-1"></div>
                            <div class="crafting-slot" data-slot="craft-2"></div>
                            <div class="crafting-slot" data-slot="craft-3"></div>
                        </div>
                        <div class="crafting-arrow">→</div>
                        <div class="crafting-result" data-slot="craft-result"></div>
                    </div>
                    
                    <!-- Main Inventory -->
                    <div class="main-inventory">
                        <!-- Inventory rows will be added dynamically -->
                    </div>
                    
                    <!-- Hotbar (mirrored from bottom of screen) -->
                    <div class="inventory-hotbar" id="inventory-hotbar">
                        <!-- Slots will be added dynamically -->
                    </div>
                </div>
                <div id="inventory-quick-craft-sidebar" class="quick-craft-sidebar" style="display: none;">
                    <div class="quick-craft-title">Quick Craft</div>
                    <div id="inventory-quick-craft-list" class="quick-craft-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Crafting Table Screen (initially hidden) -->
        <div id="crafting-table-screen" class="inventory-overlay">
            <button id="crafting-table-close-btn" class="inventory-close-btn">&times;</button>
            <div class="crafting-table-container">
                <div class="crafting-main-content">
                    <div class="inventory-title">Crafting Table</div>
                    
                    <!-- Wrap crafting elements in a horizontal row -->
                    <div class="crafting-operation-row">
                        <!-- 3x3 Crafting Grid -->
                        <div class="crafting-table-grid">
                            <div class="crafting-slot" data-slot="table-craft-0"></div>
                            <div class="crafting-slot" data-slot="table-craft-1"></div>
                            <div class="crafting-slot" data-slot="table-craft-2"></div>
                            <div class="crafting-slot" data-slot="table-craft-3"></div>
                            <div class="crafting-slot" data-slot="table-craft-4"></div>
                            <div class="crafting-slot" data-slot="table-craft-5"></div>
                            <div class="crafting-slot" data-slot="table-craft-6"></div>
                            <div class="crafting-slot" data-slot="table-craft-7"></div>
                            <div class="crafting-slot" data-slot="table-craft-8"></div>
                        </div>
                        <div class="crafting-arrow">→</div>
                        <div class="crafting-result" data-slot="table-craft-result"></div>
                    </div>
                    
                    <!-- Main Inventory -->
                    <div class="main-inventory" id="crafting-table-inventory">
                        <!-- Inventory rows will be added dynamically -->
                    </div>
                    
                    <!-- Hotbar (mirrored from bottom of screen) -->
                    <div class="inventory-hotbar" id="crafting-table-hotbar">
                        <!-- Slots will be added dynamically -->
                    </div>
                </div>
                <div id="crafting-table-quick-craft-sidebar" class="quick-craft-sidebar" style="display: none;">
                    <div class="quick-craft-title">Quick Craft</div>
                    <div id="crafting-table-quick-craft-list" class="quick-craft-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Furnace Screen (initially hidden) -->
        <div id="furnace-screen" class="inventory-overlay">
            <button id="furnace-close-btn" class="inventory-close-btn">&times;</button>
            <div class="furnace-container">
                <div class="inventory-title">Furnace</div>
                
                <!-- Furnace Interface -->
                <div class="furnace-grid">
                    <!-- Input slot -->
                    <div class="furnace-input">
                        <div class="crafting-slot" data-slot="furnace-input"></div>
                        <div class="furnace-label">Input</div>
                    </div>
                    
                    <!-- Fuel slot -->
                    <div class="furnace-fuel">
                        <div class="crafting-slot" data-slot="furnace-fuel"></div>
                        <div class="furnace-label">Fuel</div>
                    </div>
                    
                    <!-- Fire icon -->
                    <div class="furnace-fire">🔥</div>
                    
                    <!-- Arrow -->
                    <div class="crafting-arrow">→</div>
                    
                    <!-- Output slot -->
                    <div class="furnace-output">
                        <div class="crafting-result" data-slot="furnace-result"></div>
                    </div>
                </div>
                
                <!-- Main Inventory -->
                <div class="main-inventory" id="furnace-inventory">
                    <!-- Inventory rows will be added dynamically -->
                </div>
                
                <!-- Hotbar (mirrored from bottom of screen) -->
                <div class="inventory-hotbar" id="furnace-hotbar">
                    <!-- Slots will be added dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Chest Screen (initially hidden) -->
        <div id="chest-screen" class="inventory-overlay">
            <button id="chest-close-btn" class="inventory-close-btn">&times;</button>
            <div class="chest-container">
                <div class="inventory-title">Chest</div>
                
                <!-- Chest Inventory -->
                <div class="chest-inventory" id="chest-inventory">
                    <!-- Chest inventory slots will be added dynamically -->
                </div>
                
                <!-- Divider -->
                <div class="inventory-divider"></div>
                
                <!-- Player Inventory -->
                <div class="main-inventory" id="chest-player-inventory">
                    <!-- Player inventory slots will be added dynamically -->
                </div>
                
                <!-- Player Hotbar -->
                <div class="inventory-hotbar" id="chest-player-hotbar">
                    <!-- Player hotbar slots will be added dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Pause menu -->
        <div id="pause-menu" class="pause-overlay">
            <div class="pause-container">
                <h2>Game Paused</h2>
                <div id="storage-error-message" style="display: none; color: red; margin-bottom: 15px;"></div>
                
                <!-- Settings Category - Simplified to only show render distance and sensitivity -->
                <div class="settings-category">
                    <div class="category-title">Game Settings</div>
                    
                    <!-- Render distance slider -->
                    <div class="settings-option">
                        <label for="render-distance-slider">Render Distance: <span id="render-distance-value">6</span></label>
                        <input type="range" id="render-distance-slider" min="3" max="16" value="6" class="settings-slider">
                        <div class="settings-hint">Higher values = more chunks visible, lower performance</div>
                    </div>
                    
                    <!-- Camera Sensitivity in pause menu -->
                    <div class="settings-option">
                        <label for="sensitivity-pause-slider">Camera Sensitivity: <span id="sensitivity-pause-value">100%</span></label>
                        <input type="range" id="sensitivity-pause-slider" min="10" max="200" value="100" class="settings-slider">
                        <div class="settings-hint">Adjust how quickly the camera moves when looking around</div>
                    </div>
                </div>
                
                <div class="menu-buttons">
                    <button id="continue-btn" class="menu-button button-java">Continue Playing</button>
                    <button id="save-structure-ingame-btn" class="menu-button button-java" style="display:none;">Save Structure</button>
                    <button id="save-quit-btn" class="menu-button button-java">Save and Quit</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Keybind change overlay -->
    <div id="keybind-overlay" class="keybind-overlay">
        <div class="keybind-prompt">
            <p>Press a key for <span id="keybind-action">action</span></p>
            <button id="cancel-keybind-btn" class="button-java">Cancel</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.crafting-recipe-slot').forEach(slot => {
                slot.addEventListener('click', function() {
                    document.querySelectorAll('.crafting-recipe-slot').forEach(s => {
                        s.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
        });

        window.addEventListener('error', function(event) {
            if (event.target.tagName === 'IMG' || event.target.tagName === 'IMAGE') {
                console.error('Image failed to load:', event.target.src);
                event.preventDefault();
            }
        }, true);

        if (!window.websim) {
            window.websim = {
                upload: async function(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            resolve(e.target.result);
                        };
                        reader.onerror = function(e) {
                            reject(new Error('Failed to read file'));
                        };
                        reader.readAsDataURL(file);
                    });
                }
            };
        }
    </script>

    <script type="module" src="main.js"></script>
</body>
</html>