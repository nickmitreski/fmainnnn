<html>
<head>
  <title>Sonic Game Collection</title>
  <style>
    @font-face {
      font-family: 'NiseSegaSonic';
      src: url('NiseSegaSonic.TTF') format('truetype');
    }

    body {
      margin: 0;
      padding: 20px;
      background: url('sonic_mania_menu_bg.gif') center center fixed;
      background-size: cover;
      min-height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      overflow-x: auto;
    }

    /* Add a dark overlay to improve readability */
    #game-select-screen::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: -1;
    }

    #emulator {
      width: 100%;
      height: 100%;
      border: none;
      display: none;
    }

    .game-selector {
      display: flex;
      gap: 20px;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding: 10px;
    }

    .game-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s;
      min-width: 300px;
    }

    .game-option:hover {
      transform: scale(1.05);
    }

    .game-cover {
      width: 300px;
      height: 420px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .game-title {
      color: white;
      margin-top: 10px;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      text-align: center;
      font-size: 18px;
    }

    .release-year {
      color: #4a9eff;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .warning-text {
      color: #ff4a4a;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      font-size: 14px;
      text-align: center;
      margin-bottom: 5px;
    }

    /* Add styles for the warning popup */
    .warning-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 30px;
      border-radius: 10px;
      border: 2px solid #ff4a4a;
      z-index: 2000;
      width: 400px;
      text-align: center;
    }

    .warning-popup h2 {
      color: #ff4a4a;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      margin-top: 0;
      margin-bottom: 20px;
    }

    .warning-popup p {
      color: white;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .warning-popup button {
      background: #4a9eff;
      border: none;
      padding: 10px 20px;
      color: white;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .warning-popup button:hover {
      background: #3a7edf;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1999;
    }

    #game-select-screen {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Hide scrollbar but keep functionality */
    .game-selector::-webkit-scrollbar {
      height: 8px;
    }

    .game-selector::-webkit-scrollbar-track {
      background: #2a2a2a;
      border-radius: 4px;
    }

    .game-selector::-webkit-scrollbar-thumb {
      background: #4a4a4a;
      border-radius: 4px;
    }

    .game-selector::-webkit-scrollbar-thumb:hover {
      background: #5a5a5a;
    }

    .logo {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 300px;
      height: auto;
      z-index: 1000;
    }

    .disclaimer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: #ff4a4a;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      font-size: 12px;
      text-align: right;
      max-width: 300px;
      z-index: 1000;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    .console-section {
      margin-bottom: 40px;
    }

    .console-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      margin-left: 20px;
    }

    .console-logo {
      height: 40px;
      margin-right: 15px;
    }

    .console-icon {
      height: 40px;
      width: 40px;
      margin-left: 10px;
    }

    .section-divider {
      border-top: 2px solid #4a9eff;
      margin: 40px 0;
    }

    .console-warning {
      color: #ff4a4a;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      font-size: 14px;
      margin-left: 15px;
    }

    .changelog-section {
      margin: 40px 20px;
      color: white;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
    }

    .changelog-title {
      color: #4a9eff;
      font-size: 24px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .changelog-entry {
      background: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .update-version {
      color: #4a9eff;
      font-size: 18px;
      margin-bottom: 5px;
    }

    .update-details {
      color: #ffffff;
      font-size: 16px;
      padding-left: 20px;
    }

    /* Add new styles for settings */
    .settings-button {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 32px;
      height: 32px;
      cursor: pointer;
      z-index: 1000;
      transition: transform 0.3s;
    }

    .settings-button:hover {
      transform: rotate(90deg);
    }

    .settings-menu {
      position: fixed;
      top: 60px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 8px;
      padding: 15px;
      z-index: 1000;
      display: none;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5);
      min-width: 200px;
    }

    .settings-menu.visible {
      display: block;
    }

    .settings-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 10px 0;
      color: white;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #4a9eff;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    .settings-title {
      color: #4a9eff;
      font-size: 18px;
      margin-bottom: 10px;
      text-align: center;
    }

    /* Remove dim toggle related styles and add dropdown styles */
    .dropdown-select {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px;
      border: 1px solid #4a9eff;
      border-radius: 4px;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      cursor: pointer;
      width: 150px;
    }

    .dropdown-select option {
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px;
    }

    .dropdown-select:focus {
      outline: none;
      border-color: #4a9eff;
    }

    .alt-link {
      display: inline-block;
      background: #4a9eff;
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 4px;
      margin-top: 10px;
      font-family: 'NiseSegaSonic', Arial, sans-serif;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    .alt-link:hover {
      background: #3a7edf;
    }
  </style>
</head>
<body>
  <audio id="bgMusic" loop>
    <source src="BG.mp3" type="audio/mpeg">
  </audio>
  <audio id="hoverSound">
    <source src="Hover.wav" type="audio/wav">
  </audio>
  <audio id="selectSound">
    <source src="Select.wav" type="audio/wav">
  </audio>
  <img src="SMCC.png" alt="Sonic Mega Classic Collection" class="logo">
  <div class="disclaimer">
    Most/all assets in this project are not owned or managed by T4ctica1.<br>
    All rights belong to SEGA Corporation.
  </div>

  <!-- Add settings button and menu -->
  <img src="settings_cog.png" alt="Settings" class="settings-button">
  <div class="settings-menu">
    <div class="settings-title">Settings</div>
    <div class="settings-option">
      <span>Background Music</span>
      <label class="toggle-switch">
        <input type="checkbox" id="musicToggle" checked>
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="settings-option">
      <span>Sound Effects</span>
      <label class="toggle-switch">
        <input type="checkbox" id="soundToggle" checked>
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="settings-option">
      <span>Order by</span>
      <select id="orderSelect" class="dropdown-select">
        <option value="year">By Year</option>
        <option value="name">By Name</option>
        <option value="functionality">By Functionality</option>
        <option value="system">By System</option>
        <option value="canon">By Canon Order</option>
      </select>
    </div>
  </div>

  <div id="game-select-screen">
    <div class="console-section">
      <div class="console-header">
        <img src="GenesisText.png" alt="Genesis" class="console-logo">
        <img src="GenesisIcon.png" alt="Genesis Controller" class="console-icon">
      </div>
      <div class="game-selector">
        <div class="game-option" data-game="STH.html">
          <div class="release-year">(1991)</div>
          <img src="STH.jpg" alt="Sonic the Hedgehog" class="game-cover">
          <div class="game-title">Sonic the Hedgehog</div>
        </div>
        <div class="game-option" data-game="SCD.html">
          <div class="warning-text">(Experimental, Might not work)</div>
          <div class="release-year">(1993)</div>
          <img src="SCD.jpg" alt="Sonic CD" class="game-cover">
          <div class="game-title">Sonic CD</div>
        </div>
        <div class="game-option" data-game="STH2.html">
          <div class="release-year">(1992)</div>
          <img src="STH2.jpg" alt="Sonic the Hedgehog 2" class="game-cover">
          <div class="game-title">Sonic the Hedgehog 2</div>
        </div>
        <div class="game-option" data-game="STH3.html">
          <div class="release-year">(1994)</div>
          <img src="STH3.jpg" alt="Sonic the Hedgehog 3" class="game-cover">
          <div class="game-title">Sonic the Hedgehog 3</div>
        </div>
        <div class="game-option" data-game="S&K.html">
          <div class="release-year">(1994)</div>
          <img src="S&K.jpg" alt="Sonic & Knuckles" class="game-cover">
          <div class="game-title">Sonic & Knuckles</div>
        </div>
        <div class="game-option" data-game="S3&k.html">
          <div class="release-year">(1994)</div>
          <img src="S3&K.jpg" alt="Sonic 3 & Knuckles" class="game-cover">
          <div class="game-title">Sonic 3 & Knuckles</div>
        </div>
        <div class="game-option" data-game="S3C.html">
          <div class="release-year">(2013)</div>
          <img src="S3C.jpg" alt="Sonic 3 Complete" class="game-cover">
          <div class="game-title">Sonic 3 Complete</div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <div class="console-section">
      <div class="console-header">
        <img src="GameGearText.png" alt="Game Gear" class="console-logo">
        <img src="GameGearIcon.png" alt="Game Gear Icon" class="console-icon">
        <span class="console-warning">(Not fully working yet)</span>
      </div>
      <div class="game-selector">
        <div class="game-option" data-game="STHGG.html">
          <div class="release-year">(1991)</div>
          <img src="STHGG.jpg" alt="Sonic the Hedgehog (Game Gear)" class="game-cover">
          <div class="game-title">Sonic the Hedgehog</div>
        </div>
        <div class="game-option" data-game="STH2GG.html">
          <div class="release-year">(1992)</div>
          <img src="STH2GG.jpg" alt="Sonic the Hedgehog 2 (Game Gear)" class="game-cover">
          <div class="game-title">Sonic the Hedgehog 2</div>
        </div>
        <div class="game-option" data-game="SC.html">
          <div class="release-year">(1993)</div>
          <img src="SC.jpg" alt="Sonic Chaos" class="game-cover">
          <div class="game-title">Sonic Chaos</div>
        </div>
        <div class="game-option" data-game="STHTT.html">
          <div class="release-year">(1994)</div>
          <img src="STT.jpg" alt="Sonic Triple Trouble" class="game-cover">
          <div class="game-title">Sonic Triple Trouble</div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <div class="console-section">
      <div class="console-header">
        <img src="PCLogo.png" alt="PC" class="console-logo">
        <img src="PCIcon.png" alt="PC Icon" class="console-icon">
      </div>
      <div class="game-selector">
        <div class="game-option" data-game="RSDKv5.html">
          <div class="release-year">(2017)</div>
          <img src="SMP.jpg" alt="Sonic Mania Plus" class="game-cover">
          <div class="game-title">Sonic Mania Plus</div>
          <a href="https://websim.com/feed?v=@T4ctica1/Sonic-Mania-Plus" target="_blank" class="alt-link">Alt link incase it doesn't load</a>
        </div>
      </div>
    </div>

    <!-- Add warning popup -->
    <div class="overlay"></div>
    <div class="warning-popup">
      <h2>Warning!</h2>
      <p>Sonic Mania takes a while to load, but once it does, Click esc instead of going to the title screen, as the title screen crashes the game for what ever reason.</p>
      <button id="understand-btn">I Understand</button>
    </div>

    <div class="section-divider"></div>

    <div class="changelog-section">
      <h2 class="changelog-title">Changelog</h2>
      <div class="changelog-entry">
        <div class="update-version">Update 1.5</div>
        <div class="update-details">- Added the PC game tab, and Sonic Mania Plus with it!</div>
      </div>
      <div class="changelog-entry">
        <div class="update-version">Update 1.0 - Menu Update</div>
        <div class="update-details">- Updated how the Menu looks and sounds.</div>
      </div>
    </div>
  </div>

  <div id="emulator"></div>

  <script src="https://cdn.jsdelivr.net/npm/emulatorjs@1.2.1/data/loader.js"></script>
  <script>
    window.EJS_player = '#emulator';
    window.EJS_gameUrl = 'bios_CD_U.bin';
    window.EJS_biosUrl = 'Sonic CD (USA) (Alt).cue';
    window.EJS_core = 'segaCD';
    window.EJS_mouse = false;
    window.EJS_multitap = false;
    window.EJS_pathtodata = 'https://cdn.jsdelivr.net/npm/emulatorjs@1.2.1/data/';

    // Audio setup
    const bgMusic = document.getElementById('bgMusic');
    const hoverSound = document.getElementById('hoverSound');
    const selectSound = document.getElementById('selectSound');

    // Start background music when page loads
    window.addEventListener('load', () => {
      bgMusic.volume = 0.3; // Reduce volume to 30%
      bgMusic.play().catch(error => console.log("Audio autoplay blocked"));
    });

    // Add hover sound to game options
    document.querySelectorAll('.game-option').forEach(option => {
      option.addEventListener('mouseenter', () => {
        hoverSound.currentTime = 0;
        hoverSound.play().catch(error => console.log("Hover sound blocked"));
      });

      // Modify click handler to play select sound
      option.addEventListener('click', () => {
        selectSound.play().catch(error => console.log("Select sound blocked"));
        const game = option.dataset.game;
        
        // Special handling for Sonic Mania Plus
        if (game === 'RSDKv5.html') {
          document.querySelector('.overlay').style.display = 'block';
          document.querySelector('.warning-popup').style.display = 'block';
          return;
        }
        
        // For other games, proceed as normal
        setTimeout(() => {
          window.location.href = game;
        }, 100);
      });
    });

    // Add click handler for first user interaction to start background music
    document.body.addEventListener('click', () => {
      if(bgMusic.paused) {
        bgMusic.play().catch(error => console.log("Background music blocked"));
      }
    }, { once: true });

    let tabPressCount = 0;
    let lastTabPress = 0;

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        e.preventDefault();
        const currentTime = Date.now();

        if (tabPressCount === 0 || currentTime - lastTabPress > 5000) {
          tabPressCount = 1;
          lastTabPress = currentTime;
        } else {
          tabPressCount++;
        }

        if (tabPressCount >= 5) {
          showGameSelect();
          tabPressCount = 0;
        }

        lastTabPress = currentTime;
      }
    });

    function showGameSelect() {
      document.getElementById('game-select-screen').style.display = 'flex';
      document.getElementById('emulator').style.display = 'none';
    }

    function startGame() {
      document.getElementById('game-select-screen').style.display = 'none';
      document.getElementById('emulator').style.display = 'block';
    }

    // Show game select screen initially
    showGameSelect();

    // Add settings functionality
    const settingsButton = document.querySelector('.settings-button');
    const settingsMenu = document.querySelector('.settings-menu');
    const musicToggle = document.getElementById('musicToggle');
    const soundToggle = document.getElementById('soundToggle');
    const orderSelect = document.getElementById('orderSelect');

    // Toggle settings menu
    settingsButton.addEventListener('click', () => {
      settingsMenu.classList.toggle('visible');
    });

    // Close settings when clicking outside
    document.addEventListener('click', (e) => {
      if (!settingsMenu.contains(e.target) && !settingsButton.contains(e.target)) {
        settingsMenu.classList.remove('visible');
      }
    });

    // Music toggle
    musicToggle.addEventListener('change', () => {
      if (musicToggle.checked) {
        bgMusic.play().catch(error => console.log("Music play blocked"));
      } else {
        bgMusic.pause();
      }
    });

    // Sound effects toggle
    soundToggle.addEventListener('change', () => {
      hoverSound.muted = !soundToggle.checked;
      selectSound.muted = !soundToggle.checked;
    });

    // Add handler for "I Understand" button
    document.getElementById('understand-btn').addEventListener('click', () => {
      document.querySelector('.overlay').style.display = 'none';
      document.querySelector('.warning-popup').style.display = 'none';
      setTimeout(() => {
        window.location.href = 'RSDKv5.html';
      }, 100);
    });

    // Remove dim toggle related localStorage code
    function saveSettings() {
      localStorage.setItem('musicEnabled', musicToggle.checked);
      localStorage.setItem('soundEnabled', soundToggle.checked);
      localStorage.setItem('orderBy', orderSelect.value);
    }

    // Load saved settings
    window.addEventListener('load', () => {
      const savedMusic = localStorage.getItem('musicEnabled');
      const savedSound = localStorage.getItem('soundEnabled');
      const savedOrder = localStorage.getItem('orderBy');

      if (savedMusic !== null) musicToggle.checked = savedMusic === 'true';
      if (savedSound !== null) soundToggle.checked = savedSound === 'true';
      if (savedOrder !== null) orderSelect.value = savedOrder;

      // Apply initial states
      if (!musicToggle.checked) bgMusic.pause();
      hoverSound.muted = !soundToggle.checked;
      selectSound.muted = !soundToggle.checked;
      
      // Initial sort
      orderSelect.dispatchEvent(new Event('change'));
    });

    musicToggle.addEventListener('change', saveSettings);
    soundToggle.addEventListener('change', saveSettings);
    orderSelect.addEventListener('change', saveSettings);
  </script>
</body>
</html>